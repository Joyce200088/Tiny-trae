<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORS è°ƒè¯•å·¥å…·</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
        .container { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 10px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
        .url-input { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” CORS è°ƒè¯•å·¥å…·</h1>
        <p>è¯Šæ–­ ERR_BLOCKED_BY_ORB é”™è¯¯</p>
        
        <input type="text" id="testUrl" class="url-input" 
               value="https://knizbnlzwcuniceqvmvd.supabase.co/storage/v1/object/public/world-thumbnails/8adf3209-e805-4798-a859-6a6e19192f00/1759808425186_thumbnail.png"
               placeholder="è¾“å…¥è¦æµ‹è¯•çš„ URL">
        
        <button onclick="testBasicFetch()">ğŸ“¡ åŸºç¡€ Fetch æµ‹è¯•</button>
        <button onclick="testImageLoad()">ğŸ–¼ï¸ å›¾ç‰‡åŠ è½½æµ‹è¯•</button>
        <button onclick="testCorsHeaders()">ğŸ” æ£€æŸ¥ CORS å¤´éƒ¨</button>
        <button onclick="testNoCors()">ğŸš« No-CORS æ¨¡å¼</button>
        
        <div id="results" class="log">ç­‰å¾…æµ‹è¯•ç»“æœ...</div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            results.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            results.scrollTop = results.scrollHeight;
        }

        function clearLog() {
            document.getElementById('results').innerHTML = '';
        }

        async function testBasicFetch() {
            clearLog();
            const url = document.getElementById('testUrl').value;
            log(`å¼€å§‹æµ‹è¯•åŸºç¡€ Fetch: ${url}`);
            
            try {
                const response = await fetch(url);
                log(`âœ… Fetch æˆåŠŸ! Status: ${response.status}`, 'success');
                log(`Content-Type: ${response.headers.get('content-type')}`);
                log(`Content-Length: ${response.headers.get('content-length')}`);
                
                // å°è¯•è¯»å–å“åº”
                const blob = await response.blob();
                log(`âœ… å“åº”è¯»å–æˆåŠŸ! Size: ${blob.size} bytes`, 'success');
                
            } catch (error) {
                log(`âŒ Fetch å¤±è´¥: ${error.message}`, 'error');
                log(`Error type: ${error.name}`, 'error');
            }
        }

        async function testImageLoad() {
            clearLog();
            const url = document.getElementById('testUrl').value;
            log(`å¼€å§‹æµ‹è¯•å›¾ç‰‡åŠ è½½: ${url}`);
            
            const img = new Image();
            img.crossOrigin = 'anonymous';
            
            img.onload = function() {
                log(`âœ… å›¾ç‰‡åŠ è½½æˆåŠŸ! å°ºå¯¸: ${img.width}x${img.height}`, 'success');
            };
            
            img.onerror = function(e) {
                log(`âŒ å›¾ç‰‡åŠ è½½å¤±è´¥`, 'error');
                log(`Error event: ${JSON.stringify(e)}`, 'error');
            };
            
            img.src = url;
        }

        async function testCorsHeaders() {
            clearLog();
            const url = document.getElementById('testUrl').value;
            log(`å¼€å§‹æ£€æŸ¥ CORS å¤´éƒ¨: ${url}`);
            
            try {
                const response = await fetch(url, {
                    method: 'HEAD'
                });
                
                log(`âœ… HEAD è¯·æ±‚æˆåŠŸ! Status: ${response.status}`, 'success');
                
                // æ£€æŸ¥é‡è¦çš„ CORS å¤´éƒ¨
                const corsHeaders = [
                    'access-control-allow-origin',
                    'access-control-allow-methods',
                    'access-control-allow-headers',
                    'content-type',
                    'cache-control'
                ];
                
                corsHeaders.forEach(header => {
                    const value = response.headers.get(header);
                    if (value) {
                        log(`${header}: ${value}`);
                    } else {
                        log(`${header}: (æœªè®¾ç½®)`, 'error');
                    }
                });
                
            } catch (error) {
                log(`âŒ HEAD è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testNoCors() {
            clearLog();
            const url = document.getElementById('testUrl').value;
            log(`å¼€å§‹æµ‹è¯• No-CORS æ¨¡å¼: ${url}`);
            
            try {
                const response = await fetch(url, {
                    mode: 'no-cors'
                });
                
                log(`âœ… No-CORS è¯·æ±‚æˆåŠŸ! Status: ${response.status}`, 'success');
                log(`Response type: ${response.type}`);
                
                // åœ¨ no-cors æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬æ— æ³•è¯»å–å“åº”å†…å®¹
                log(`æ³¨æ„: no-cors æ¨¡å¼ä¸‹æ— æ³•è¯»å–å“åº”å†…å®¹`);
                
            } catch (error) {
                log(`âŒ No-CORS è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.onload = function() {
            log('ğŸš€ CORS è°ƒè¯•å·¥å…·å·²åŠ è½½');
            log('ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...');
        };
    </script>
</body>
</html>