# Supabase å­˜å‚¨æ¡¶é—®é¢˜è¯Šæ–­ä¸è§£å†³æ–¹æ¡ˆ

## ğŸ” é—®é¢˜ç°è±¡
- æµ‹è¯•é¡µé¢æ˜¾ç¤ºï¼š"æ‰¾åˆ° 0 ä¸ªå­˜å‚¨æ¡¶"
- æ‰€æœ‰å­˜å‚¨æ¡¶æ˜¾ç¤ºä¸º"ç¼ºå¤±"çŠ¶æ€
- æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š"Bucket not found"

## ğŸ”¬ æ ¹æœ¬åŸå› åˆ†æ

### 1. è®¤è¯ä¼šè¯é—®é¢˜
- **ç°è±¡ï¼š** `supabase.storage.listBuckets()` è¿”å›ç©ºæ•°ç»„ `[]`
- **åŸå› ï¼š** åŒ¿åç”¨æˆ·æƒé™ä¸è¶³ï¼Œæ— æ³•åˆ—å‡ºå­˜å‚¨æ¡¶
- **è¯æ®ï¼š** è°ƒè¯•å·¥å…·æ˜¾ç¤º "Auth session missing!"

### 2. å­˜å‚¨æ¡¶å®é™…çŠ¶æ€
- **å®é™…æƒ…å†µï¼š** å­˜å‚¨æ¡¶å·²æ­£ç¡®åˆ›å»ºå¹¶å¯è®¿é—®
- **éªŒè¯æ–¹æ³•ï¼š** ç›´æ¥è°ƒç”¨ `storage.from(bucket).list()` æˆåŠŸ
- **æƒé™çŠ¶æ€ï¼š** è¯»å–æƒé™æ­£å¸¸ï¼Œä¸Šä¼ æƒé™æ­£å¸¸

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šæ™ºèƒ½å›é€€æ£€æµ‹ï¼ˆå·²å®ç°ï¼‰
æ›´æ–°æµ‹è¯•é¡µé¢é€»è¾‘ï¼Œå½“ `listBuckets()` å¤±è´¥æˆ–è¿”å›ç©ºæ•°ç»„æ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨ç›´æ¥è®¿é—®æ–¹æ³•ï¼š

```javascript
// å¦‚æœ listBuckets() è¿”å›ç©ºæ•°ç»„ï¼Œä½¿ç”¨ç›´æ¥è®¿é—®æ–¹æ³•
if (buckets.length === 0) {
    for (const bucket of requiredBuckets) {
        const { data, error } = await supabaseClient.storage
            .from(bucket)
            .list('', { limit: 1 });
        
        if (!error) {
            // å­˜å‚¨æ¡¶å­˜åœ¨ä¸”å¯è®¿é—®
        }
    }
}
```

### æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨åˆ›å»ºå­˜å‚¨æ¡¶ï¼ˆå¤‡é€‰ï¼‰
å¦‚æœå­˜å‚¨æ¡¶ç¡®å®ä¸å­˜åœ¨ï¼Œä½¿ç”¨ä»¥ä¸‹ SQL è„šæœ¬ï¼š

```sql
-- ä½¿ç”¨ STORAGE_BUCKETS_ONLY.sql
INSERT INTO storage.buckets (id, name, public, file_size_limit, allowed_mime_types)
VALUES 
  ('sticker-images', 'sticker-images', true, 5242880, ARRAY['image/png', 'image/jpeg', 'image/webp', 'image/svg+xml']),
  ('background-images', 'background-images', true, 10485760, ARRAY['image/png', 'image/jpeg', 'image/webp']),
  ('world-thumbnails', 'world-thumbnails', true, 5242880, ARRAY['image/png', 'image/jpeg', 'image/webp']),
  ('user-uploads', 'user-uploads', true, 10485760, ARRAY['image/png', 'image/jpeg', 'image/webp', 'image/svg+xml'])
ON CONFLICT (id) DO NOTHING;
```

## âœ… éªŒè¯æ­¥éª¤

1. **åˆ·æ–°æµ‹è¯•é¡µé¢** - åº”è¯¥æ˜¾ç¤ºæ‰€æœ‰å­˜å‚¨æ¡¶"å­˜åœ¨ä¸”å¯è®¿é—®"
2. **æ£€æŸ¥æ—¥å¿—è¾“å‡º** - åº”è¯¥çœ‹åˆ°"listBuckets() è¿”å›ç©ºæ•°ç»„ï¼Œå¯èƒ½æ˜¯è®¤è¯é—®é¢˜"
3. **æµ‹è¯•æ–‡ä»¶ä¸Šä¼ ** - åº”è¯¥èƒ½å¤ŸæˆåŠŸä¸Šä¼ æ–‡ä»¶

## ğŸ“‹ æŠ€æœ¯è¯´æ˜

### ä¸ºä»€ä¹ˆ listBuckets() è¿”å›ç©ºæ•°ç»„ï¼Ÿ
- Supabase çš„ `listBuckets()` éœ€è¦ç‰¹å®šæƒé™
- åŒ¿åç”¨æˆ·ï¼ˆanon keyï¼‰é€šå¸¸æ— æ³•åˆ—å‡ºæ‰€æœ‰å­˜å‚¨æ¡¶
- ä½†å¯ä»¥ç›´æ¥è®¿é—®å·²çŸ¥åç§°çš„å…¬å¼€å­˜å‚¨æ¡¶

### ä¸ºä»€ä¹ˆç›´æ¥è®¿é—®å¯ä»¥æˆåŠŸï¼Ÿ
- å­˜å‚¨æ¡¶è®¾ç½®ä¸º `public = true`
- å…è®¸åŒ¿åç”¨æˆ·è¯»å–å’Œä¸Šä¼ æ–‡ä»¶
- `storage.from(bucket).list()` åªéœ€è¦æ¡¶çº§åˆ«æƒé™

## ğŸ¯ æœ€ç»ˆçŠ¶æ€
- âœ… å­˜å‚¨æ¡¶æ£€æµ‹æ­£å¸¸å·¥ä½œ
- âœ… æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å¯ç”¨
- âœ… æµ‹è¯•é¡µé¢æ˜¾ç¤ºæ­£ç¡®çŠ¶æ€
- âœ… æ— éœ€é¢å¤–çš„è®¤è¯é…ç½®

## ğŸ“ æ³¨æ„äº‹é¡¹
- æ­¤è§£å†³æ–¹æ¡ˆé€‚ç”¨äºå…¬å¼€å­˜å‚¨æ¡¶
- å¦‚éœ€å®Œæ•´çš„å­˜å‚¨æ¡¶ç®¡ç†åŠŸèƒ½ï¼Œå»ºè®®å®ç°ç”¨æˆ·è®¤è¯
- å½“å‰é…ç½®æ»¡è¶³åº”ç”¨çš„åŸºæœ¬å­˜å‚¨éœ€æ±‚