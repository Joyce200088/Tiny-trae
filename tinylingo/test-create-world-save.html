<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ›å»ºä¸–ç•Œä¿å­˜åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #FFFBF5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        .iframe-container {
            width: 100%;
            height: 600px;
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>åˆ›å»ºä¸–ç•Œä¿å­˜åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="section">
            <h2>æµ‹è¯•è¯´æ˜</h2>
            <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•åˆ›å»ºä¸–ç•Œé¡µé¢çš„ä¿å­˜åŠŸèƒ½ã€‚è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p>
            <ol>
                <li>åœ¨ä¸‹æ–¹çš„åˆ›å»ºä¸–ç•Œé¡µé¢ä¸­æ·»åŠ ä¸€äº›å†…å®¹ï¼ˆèƒŒæ™¯ã€è´´çº¸ç­‰ï¼‰</li>
                <li>ç‚¹å‡»ä¿å­˜æŒ‰é’®æˆ–ç­‰å¾…è‡ªåŠ¨ä¿å­˜</li>
                <li>æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„è°ƒè¯•æ—¥å¿—</li>
                <li>æ£€æŸ¥localStorageä¸­çš„æ•°æ®</li>
            </ol>
        </div>

        <div class="section">
            <h2>æ§åˆ¶é¢æ¿</h2>
            <button class="button" onclick="openDevTools()">æ‰“å¼€å¼€å‘è€…å·¥å…·</button>
            <button class="button" onclick="checkLocalStorage()">æ£€æŸ¥localStorage</button>
            <button class="button" onclick="clearLocalStorage()">æ¸…ç©ºlocalStorage</button>
            <button class="button" onclick="refreshIframe()">åˆ·æ–°é¡µé¢</button>
        </div>

        <div class="section">
            <h2>localStorage æ•°æ®</h2>
            <div id="localStorageData" class="log">ç‚¹å‡»"æ£€æŸ¥localStorage"æŸ¥çœ‹æ•°æ®...</div>
        </div>

        <div class="section">
            <h2>åˆ›å»ºä¸–ç•Œé¡µé¢</h2>
            <div class="iframe-container">
                <iframe id="createWorldFrame" src="http://localhost:3000/create-world"></iframe>
            </div>
        </div>

        <div class="section">
            <h2>æ“ä½œæ—¥å¿—</h2>
            <div id="operationLog" class="log">æ“ä½œæ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
        </div>
    </div>

    <script>
        // æ—¥å¿—å‡½æ•°
        function log(message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('operationLog');
            const logMessage = `[${timestamp}] ${message}`;
            
            if (data) {
                logElement.textContent += logMessage + '\n' + JSON.stringify(data, null, 2) + '\n\n';
            } else {
                logElement.textContent += logMessage + '\n';
            }
            
            logElement.scrollTop = logElement.scrollHeight;
            console.log(logMessage, data);
        }

        // æ‰“å¼€å¼€å‘è€…å·¥å…·
        function openDevTools() {
            log('ğŸ’¡ è¯·æŒ‰ F12 æˆ–å³é”®é€‰æ‹©"æ£€æŸ¥"æ¥æ‰“å¼€å¼€å‘è€…å·¥å…·');
            log('ğŸ’¡ åœ¨æ§åˆ¶å°ä¸­æŸ¥çœ‹ä»¥ ğŸ”„ã€ğŸ“Šã€ğŸ–¼ï¸ã€âœ…ã€âŒ ç­‰emojiå¼€å¤´çš„è°ƒè¯•æ—¥å¿—');
        }

        // æ£€æŸ¥localStorage
        function checkLocalStorage() {
            log('ğŸ” æ£€æŸ¥localStorageæ•°æ®...');
            
            const localStorageElement = document.getElementById('localStorageData');
            let output = '';
            
            // æŸ¥æ‰¾æ‰€æœ‰tinylingoç›¸å…³çš„é”®
            const keys = Object.keys(localStorage).filter(key => key.includes('tinylingo'));
            
            if (keys.length === 0) {
                output = 'æ²¡æœ‰æ‰¾åˆ°tinylingoç›¸å…³çš„æ•°æ®';
                log('ğŸ“­ localStorageä¸­æ²¡æœ‰tinylingoæ•°æ®');
            } else {
                keys.forEach(key => {
                    try {
                        const value = localStorage.getItem(key);
                        const parsedValue = JSON.parse(value);
                        output += `${key}:\n${JSON.stringify(parsedValue, null, 2)}\n\n`;
                        
                        if (key.includes('worlds')) {
                            log(`ğŸ“š æ‰¾åˆ°ä¸–ç•Œæ•°æ®: ${key}, åŒ…å« ${parsedValue.length} ä¸ªä¸–ç•Œ`);
                        } else {
                            log(`ğŸ“„ æ‰¾åˆ°æ•°æ®: ${key}`);
                        }
                    } catch (error) {
                        output += `${key}: ${value}\n\n`;
                        log(`âš ï¸ æ•°æ®è§£æå¤±è´¥: ${key}`);
                    }
                });
            }
            
            localStorageElement.textContent = output;
        }

        // æ¸…ç©ºlocalStorage
        function clearLocalStorage() {
            const keys = Object.keys(localStorage).filter(key => key.includes('tinylingo'));
            keys.forEach(key => localStorage.removeItem(key));
            
            log(`ğŸ—‘ï¸ å·²æ¸…ç©º ${keys.length} ä¸ªtinylingoç›¸å…³çš„localStorageé¡¹`);
            checkLocalStorage();
        }

        // åˆ·æ–°iframe
        function refreshIframe() {
            const iframe = document.getElementById('createWorldFrame');
            iframe.src = iframe.src;
            log('ğŸ”„ å·²åˆ·æ–°åˆ›å»ºä¸–ç•Œé¡µé¢');
        }

        // ç›‘å¬localStorageå˜åŒ–
        window.addEventListener('storage', (e) => {
            if (e.key && e.key.includes('tinylingo')) {
                log('ğŸ“¡ æ£€æµ‹åˆ°localStorageå˜åŒ–:', e.key);
                checkLocalStorage();
            }
        });

        // ç›‘å¬iframeä¸­çš„æ¶ˆæ¯
        window.addEventListener('message', (event) => {
            if (event.origin === 'http://localhost:3000') {
                log('ğŸ“¨ æ”¶åˆ°iframeæ¶ˆæ¯:', event.data);
            }
        });

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        window.addEventListener('load', () => {
            log('ğŸ“± æµ‹è¯•é¡µé¢å·²åŠ è½½');
            checkLocalStorage();
            
            // å®šæœŸæ£€æŸ¥localStorageå˜åŒ–
            setInterval(() => {
                const keys = Object.keys(localStorage).filter(key => key.includes('tinylingo'));
                if (keys.length > 0) {
                    // é™é»˜æ£€æŸ¥ï¼Œä¸æ˜¾ç¤ºæ—¥å¿—
                    const localStorageElement = document.getElementById('localStorageData');
                    let output = '';
                    keys.forEach(key => {
                        try {
                            const value = localStorage.getItem(key);
                            const parsedValue = JSON.parse(value);
                            output += `${key}:\n${JSON.stringify(parsedValue, null, 2)}\n\n`;
                        } catch (error) {
                            output += `${key}: ${value}\n\n`;
                        }
                    });
                    localStorageElement.textContent = output;
                }
            }, 2000); // æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡
        });

        // æ·»åŠ ä¸€äº›æœ‰ç”¨çš„è°ƒè¯•å‡½æ•°åˆ°å…¨å±€ä½œç”¨åŸŸ
        window.debugTinyLingo = {
            checkStorage: checkLocalStorage,
            clearStorage: clearLocalStorage,
            log: log
        };

        log('ğŸš€ åˆ›å»ºä¸–ç•Œä¿å­˜åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åˆå§‹åŒ–');
        log('ğŸ’¡ æç¤ºï¼šæ‰“å¼€å¼€å‘è€…å·¥å…·æŸ¥çœ‹è¯¦ç»†çš„ä¿å­˜è¿‡ç¨‹æ—¥å¿—');
    </script>
</body>
</html>