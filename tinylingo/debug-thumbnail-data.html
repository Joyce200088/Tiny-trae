<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>缩略图数据调试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #FFFBF5;
        }
        .world-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: white;
        }
        .thumbnail-preview {
            max-width: 200px;
            max-height: 150px;
            border: 1px solid #ddd;
            margin: 10px 0;
        }
        .error {
            color: red;
        }
        .success {
            color: green;
        }
        .info {
            color: blue;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>缩略图数据调试</h1>
    <button onclick="loadAndDisplayWorlds()">加载世界数据</button>
    <div id="worldsContainer"></div>

    <script>
        function loadAndDisplayWorlds() {
            const container = document.getElementById('worldsContainer');
            container.innerHTML = '';

            try {
                // 获取所有localStorage键
                const keys = Object.keys(localStorage);
                const worldKeys = keys.filter(key => key.includes('tinylingo_worlds'));
                
                console.log('找到的世界数据键:', worldKeys);

                if (worldKeys.length === 0) {
                    container.innerHTML = '<p class="error">未找到世界数据</p>';
                    return;
                }

                worldKeys.forEach(key => {
                    const data = localStorage.getItem(key);
                    if (data) {
                        try {
                            const worlds = JSON.parse(data);
                            console.log(`键 "${key}" 包含的世界:`, worlds);

                            const keySection = document.createElement('div');
                            keySection.innerHTML = `<h2>存储键: ${key}</h2>`;
                            container.appendChild(keySection);

                            worlds.forEach((world, index) => {
                                const worldDiv = document.createElement('div');
                                worldDiv.className = 'world-item';
                                
                                const thumbnailStatus = world.thumbnail ? 
                                    `<span class="success">有缩略图</span>` : 
                                    `<span class="error">无缩略图</span>`;

                                const thumbnailPreview = world.thumbnail ? 
                                    `<div>
                                        <strong>缩略图预览:</strong><br>
                                        <img src="${world.thumbnail}" alt="${world.name}" class="thumbnail-preview" 
                                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                        <div style="display:none; color: red;">缩略图加载失败</div>
                                        <div><strong>URL:</strong> <code>${world.thumbnail}</code></div>
                                     </div>` : 
                                    '<div class="error">无缩略图数据</div>';

                                worldDiv.innerHTML = `
                                    <h3>${world.name} ${thumbnailStatus}</h3>
                                    <p><strong>ID:</strong> ${world.id}</p>
                                    <p><strong>创建时间:</strong> ${world.createdAt || '未知'}</p>
                                    ${thumbnailPreview}
                                    <details>
                                        <summary>完整数据</summary>
                                        <pre>${JSON.stringify(world, null, 2)}</pre>
                                    </details>
                                `;
                                
                                container.appendChild(worldDiv);
                            });
                        } catch (parseError) {
                            const errorDiv = document.createElement('div');
                            errorDiv.className = 'world-item error';
                            errorDiv.innerHTML = `<h3>解析错误</h3><p>键: ${key}</p><p>错误: ${parseError.message}</p>`;
                            container.appendChild(errorDiv);
                        }
                    }
                });
            } catch (error) {
                container.innerHTML = `<div class="error">加载失败: ${error.message}</div>`;
            }
        }

        // 页面加载时自动执行
        window.onload = loadAndDisplayWorlds;
    </script>
</body>
</html>