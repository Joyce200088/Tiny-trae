<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>缩略图数据库检查工具</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #FFFBF5;
        }
        .debug-container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        
        .world-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            background: #f8f9fa;
        }
        .world-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .world-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        .world-id {
            font-size: 12px;
            color: #666;
            font-family: monospace;
        }
        .thumbnail-test {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 15px 0;
        }
        .thumbnail-info {
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 15px;
        }
        .thumbnail-preview {
            max-width: 200px;
            max-height: 150px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        .url-display {
            font-family: monospace;
            font-size: 12px;
            background: #f0f0f0;
            padding: 5px;
            border-radius: 3px;
            word-break: break-all;
            margin: 5px 0;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>🔍 缩略图数据库检查工具</h1>
        
        <div class="status info">
            <strong>检查目标：</strong>
            <ul>
                <li>数据库中世界的缩略图字段是否正确保存</li>
                <li>缩略图URL是否可以正常访问</li>
                <li>图片加载失败的具体原因</li>
                <li>Storage中的文件是否存在</li>
            </ul>
        </div>

        <div style="text-align: center; margin: 20px 0;">
            <button class="test-button" onclick="checkDatabase()">🔍 检查数据库缩略图</button>
            <button class="test-button" onclick="testImageLoading()">🖼️ 测试图片加载</button>
            <button class="test-button" onclick="checkStorageFiles()">📁 检查Storage文件</button>
            <button class="test-button" onclick="clearResults()">🧹 清除结果</button>
        </div>

        <div id="results"></div>
    </div>

    <script type="module">
        // 模拟Supabase客户端
        const mockSupabaseClient = {
            from: (table) => ({
                select: (fields = '*') => ({
                    eq: (column, value) => ({
                        single: () => Promise.resolve({
                            data: null,
                            error: { message: '模拟数据库连接 - 请在实际环境中测试' }
                        })
                    }),
                    limit: (count) => Promise.resolve({
                        data: [],
                        error: { message: '模拟数据库连接 - 请在实际环境中测试' }
                    })
                })
            }),
            storage: {
                from: (bucket) => ({
                    list: (path = '') => Promise.resolve({
                        data: [],
                        error: { message: '模拟Storage连接 - 请在实际环境中测试' }
                    }),
                    getPublicUrl: (path) => ({
                        data: { publicUrl: `https://mock-storage.supabase.co/storage/v1/object/public/${bucket}/${path}` }
                    })
                })
            }
        };

        // 实际的WorldDataUtils实现
        const RealWorldDataUtils = {
            /**
             * 获取当前用户专属的存储键
             * 格式：tinylingo_worlds_[userId] 或 tinylingo_worlds_guest（未登录用户）
             */
            async getUserStorageKey() {
                try {
                    // 这里简化处理，直接使用访客键
                    // 在实际环境中会尝试获取用户ID
                    return 'tinylingo_worlds_guest';
                } catch (error) {
                    console.warn('获取用户ID失败，使用访客模式:', error);
                    return 'tinylingo_worlds_guest';
                }
            },

            /**
             * 从localStorage加载世界数据
             * 使用用户专属的存储键，确保数据隔离
             */
            async loadWorldData() {
                try {
                    if (typeof window === 'undefined') return [];
                    
                    const storageKey = await this.getUserStorageKey();
                    const savedData = localStorage.getItem(storageKey);
                    if (!savedData) {
                        console.log('没有找到世界数据，尝试检查其他可能的键...');
                        
                        // 检查所有可能的localStorage键
                        const allKeys = [];
                        for (let i = 0; i < localStorage.length; i++) {
                            const key = localStorage.key(i);
                            if (key && key.includes('tinylingo') || key.includes('world')) {
                                allKeys.push(key);
                            }
                        }
                        console.log('找到的相关localStorage键:', allKeys);
                        
                        return [];
                    }

                    const parsedData = JSON.parse(savedData);
                    const worlds = Array.isArray(parsedData) ? parsedData : [];
                    console.log(`从localStorage加载世界数据 (键: ${storageKey}):`, worlds.length, '个世界');
                    return worlds;
                } catch (error) {
                    console.error('加载世界数据失败:', error);
                    return [];
                }
            },

            /**
             * 获取所有世界数据
             * 支持用户数据隔离
             */
            async getAllWorlds() {
                return await this.loadWorldData();
            },

            /**
             * 检查所有localStorage中的世界相关数据
             */
            async getAllStorageKeys() {
                const keys = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key) {
                        keys.push({
                            key: key,
                            size: localStorage.getItem(key)?.length || 0,
                            isWorldData: key.includes('tinylingo') || key.includes('world')
                        });
                    }
                }
                return keys;
            }
        };

        // 辅助函数：获取缩略图类型
        function getThumbnailType(thumbnail) {
            if (!thumbnail) return 'None';
            if (thumbnail.startsWith('data:image/')) return 'Base64';
            if (thumbnail.startsWith('http://') || thumbnail.startsWith('https://')) return 'HTTP URL';
            if (thumbnail.startsWith('blob:')) return 'Blob URL';
            return 'Unknown';
        }

        // 辅助函数：获取缩略图类型（全局函数）
        window.getThumbnailType = getThumbnailType;

        // 检查数据库中的缩略图数据
        window.checkDatabase = async function() {
            const resultsEl = document.getElementById('results');
            resultsEl.innerHTML = '<div class="loading">🔍 正在检查数据库中的缩略图数据...</div>';

            try {
                console.log('=== 开始检查数据库缩略图 ===');
                
                // 1. 获取所有localStorage键并查找世界数据
                const allKeys = await RealWorldDataUtils.getAllStorageKeys();
                console.log('所有localStorage键:', allKeys);
                
                let worlds = [];
                let dataSourceInfo = [];
                
                // 尝试从所有可能的键中加载世界数据
                for (const keyInfo of allKeys) {
                    try {
                        const data = localStorage.getItem(keyInfo.key);
                        if (data) {
                            const parsed = JSON.parse(data);
                            
                            // 检查不同的数据格式
                            if (parsed.worlds && typeof parsed.worlds === 'object') {
                                // 格式: { worlds: { worldId: worldData } }
                                const worldsArray = Object.values(parsed.worlds);
                                if (worldsArray.length > 0) {
                                    worlds.push(...worldsArray);
                                    dataSourceInfo.push(`✅ 从键 "${keyInfo.key}" 的 worlds 属性中找到 ${worldsArray.length} 个世界`);
                                }
                            } else if (Array.isArray(parsed)) {
                                // 格式: [worldData1, worldData2, ...]
                                if (parsed.length > 0 && parsed[0].id) {
                                    worlds.push(...parsed);
                                    dataSourceInfo.push(`✅ 从键 "${keyInfo.key}" 的数组中找到 ${parsed.length} 个世界`);
                                }
                            } else if (parsed.id && parsed.title) {
                                // 格式: 单个世界对象
                                worlds.push(parsed);
                                dataSourceInfo.push(`✅ 从键 "${keyInfo.key}" 中找到 1 个世界`);
                            } else if (typeof parsed === 'object') {
                                // 检查对象的属性是否包含世界数据
                                const possibleWorlds = Object.values(parsed).filter(item => 
                                    item && typeof item === 'object' && item.id && item.title
                                );
                                if (possibleWorlds.length > 0) {
                                    worlds.push(...possibleWorlds);
                                    dataSourceInfo.push(`✅ 从键 "${keyInfo.key}" 的对象属性中找到 ${possibleWorlds.length} 个世界`);
                                }
                            }
                        }
                    } catch (e) {
                        console.warn('解析键失败:', keyInfo.key, e);
                    }
                }
                
                // 去重（基于世界ID）
                const uniqueWorlds = [];
                const seenIds = new Set();
                for (const world of worlds) {
                    if (!seenIds.has(world.id)) {
                        uniqueWorlds.push(world);
                        seenIds.add(world.id);
                    }
                }
                worlds = uniqueWorlds;
                
                if (worlds.length === 0) {
                    let warningHtml = '<div class="status warning">⚠️ 没有找到世界数据</div>';
                    
                    // 显示所有localStorage键的信息
                    if (allKeys.length > 0) {
                        warningHtml += '<div class="status info"><h4>📋 localStorage中的所有键:</h4><ul>';
                        allKeys.forEach(keyInfo => {
                            warningHtml += `<li><strong>${keyInfo.key}</strong> (${keyInfo.size} 字符) ${keyInfo.isWorldData ? '🌍' : ''}</li>`;
                        });
                        warningHtml += '</ul></div>';
                    }
                    
                    resultsEl.innerHTML = warningHtml;
                    return;
                }
                
                // 显示数据来源信息
                let resultsHtml = `<div class="status success">📊 总共找到 ${worlds.length} 个世界</div>`;
                resultsHtml += '<div class="status info"><h4>📋 数据来源:</h4><ul>';
                dataSourceInfo.forEach(info => {
                    resultsHtml += `<li>${info}</li>`;
                });
                resultsHtml += '</ul></div>';

                // 2. 分析每个世界的缩略图数据
                for (let i = 0; i < worlds.length; i++) {
                    const world = worlds[i];
                    console.log(`分析世界 ${i + 1}:`, world);
                    
                    resultsHtml += `<div class="world-item">
                        <h3>🌍 世界 ${i + 1}: ${world.title || world.id}</h3>
                        <div class="world-details">
                            <p><strong>ID:</strong> ${world.id}</p>
                            <p><strong>标题:</strong> ${world.title || '未设置'}</p>
                            <p><strong>描述:</strong> ${world.description || '未设置'}</p>
                        </div>`;
                    
                    // 检查缩略图数据
                    if (world.thumbnail) {
                        const thumbnailType = getThumbnailType(world.thumbnail);
                        resultsHtml += `<div class="thumbnail-info">
                            <p><strong>✅ 缩略图:</strong> 存在</p>
                            <p><strong>类型:</strong> ${thumbnailType}</p>
                            <p><strong>长度:</strong> ${world.thumbnail.length} 字符</p>`;
                        
                        if (thumbnailType === 'Base64') {
                            resultsHtml += `<p><strong>Base64前缀:</strong> ${world.thumbnail.substring(0, 50)}...</p>`;
                        } else {
                            resultsHtml += `<p><strong>URL:</strong> ${world.thumbnail}</p>`;
                        }
                        
                        // 测试图片加载
                        resultsHtml += '<div class="image-test">';
                        resultsHtml += '<p><strong>🖼️ 图片加载测试:</strong></p>';
                        resultsHtml += `<img src="${world.thumbnail}" 
                                           style="max-width: 100px; max-height: 100px; border: 1px solid #ccc;" 
                                           onload="this.nextElementSibling.innerHTML='✅ 加载成功'" 
                                           onerror="this.nextElementSibling.innerHTML='❌ 加载失败'">`;
                        resultsHtml += '<span class="load-status">⏳ 加载中...</span>';
                        resultsHtml += '</div>';
                        
                    } else {
                        resultsHtml += `<div class="thumbnail-info">
                            <p><strong>❌ 缩略图:</strong> 不存在</p>
                        </div>`;
                    }
                    
                    // 检查其他可能的图片字段
                    const imageFields = ['previewImage', 'coverUrl', 'image'];
                    for (const field of imageFields) {
                        if (world[field]) {
                            resultsHtml += `<div class="other-image">
                                <p><strong>📷 ${field}:</strong> ${getThumbnailType(world[field])} (${world[field].length} 字符)</p>
                            </div>`;
                        }
                    }
                    
                    resultsHtml += '</div>';
                }
                
                // 3. Storage文件检查（模拟）
                resultsHtml += `<div class="storage-check">
                    <h3>📁 Storage文件检查</h3>
                    <p class="warning">⚠️ 这是模拟检查，实际需要连接Supabase Storage</p>
                    <div class="simulated-check">
                        <p>✅ 模拟检查完成</p>
                        <p>📊 建议检查Supabase Storage中的文件是否存在</p>
                    </div>
                </div>`;
                
                resultsEl.innerHTML = resultsHtml;
                
                // 2. 分析每个世界的缩略图数据
                let worldsWithThumbnail = 0;
                let worldsWithValidUrl = 0;
                let worldsWithBase64 = 0;
                let worldsWithBlobUrl = 0;
                let worldsWithoutThumbnail = 0;

                for (const world of worlds) {
                    const hasThumbnail = !!world.thumbnail;
                    const isValidUrl = world.thumbnail && (world.thumbnail.startsWith('http') || world.thumbnail.startsWith('https'));
                    const isBase64 = world.thumbnail && world.thumbnail.startsWith('data:');
                    const isBlobUrl = world.thumbnail && world.thumbnail.startsWith('blob:');

                    if (hasThumbnail) {
                        worldsWithThumbnail++;
                        if (isValidUrl) worldsWithValidUrl++;
                        if (isBase64) worldsWithBase64++;
                        if (isBlobUrl) worldsWithBlobUrl++;
                    } else {
                        worldsWithoutThumbnail++;
                    }

                    // 为每个世界创建详细信息卡片
                    resultsHtml += `
                        <div class="world-card">
                            <div class="world-header">
                                <div class="world-name">${world.name || '未命名世界'}</div>
                                <div class="world-id">ID: ${world.id}</div>
                            </div>
                            
                            <div class="thumbnail-test">
                                <div class="thumbnail-info">
                                    <h4>📋 缩略图数据分析</h4>
                                    <p><strong>缩略图状态:</strong> ${hasThumbnail ? '✅ 有' : '❌ 无'}</p>
                                    ${hasThumbnail ? `
                                        <p><strong>数据类型:</strong> ${isValidUrl ? '🌐 HTTP URL' : isBase64 ? '📄 Base64' : isBlobUrl ? '🔗 Blob URL' : '❓ 未知格式'}</p>
                                        <p><strong>数据长度:</strong> ${world.thumbnail.length} 字符</p>
                                        <div class="url-display">
                                            <strong>URL预览:</strong><br>
                                            ${world.thumbnail.substring(0, 100)}${world.thumbnail.length > 100 ? '...' : ''}
                                        </div>
                                    ` : '<p style="color: #dc3545;">无缩略图数据</p>'}
                                    
                                    <p><strong>其他图片字段:</strong></p>
                                    <ul style="font-size: 12px;">
                                        <li>previewImage: ${world.previewImage ? '✅ 有' : '❌ 无'}</li>
                                        <li>coverUrl: ${world.coverUrl ? '✅ 有' : '❌ 无'}</li>
                                    </ul>
                                </div>
                                
                                <div class="thumbnail-info">
                                    <h4>🖼️ 缩略图预览测试</h4>
                                    ${hasThumbnail ? `
                                        <img src="${world.thumbnail}" 
                                             class="thumbnail-preview" 
                                             alt="${world.name}"
                                             onload="console.log('世界 ${world.name} 缩略图加载成功'); this.nextElementSibling.innerHTML = '✅ 图片加载成功'"
                                             onerror="console.error('世界 ${world.name} 缩略图加载失败'); this.style.display='none'; this.nextElementSibling.innerHTML = '❌ 图片加载失败 - 可能是URL无效或文件不存在'">
                                        <div class="status info">⏳ 正在加载...</div>
                                    ` : '<div class="status warning">无缩略图可预览</div>'}
                                </div>
                            </div>
                            
                            <div style="margin-top: 10px;">
                                <button class="test-button" onclick="testSingleWorldThumbnail('${world.id}')">🔍 详细测试此世界</button>
                            </div>
                        </div>
                    `;
                }

                // 3. 添加统计摘要
                resultsHtml += `
                    <div class="status ${worldsWithThumbnail > 0 ? 'success' : 'warning'}">
                        <h3>📊 缩略图数据统计</h3>
                        <ul>
                            <li>总世界数: ${worlds.length}</li>
                            <li>有缩略图: ${worldsWithThumbnail} 个</li>
                            <li>无缩略图: ${worldsWithoutThumbnail} 个</li>
                            <li>HTTP URL格式: ${worldsWithValidUrl} 个</li>
                            <li>Base64格式: ${worldsWithBase64} 个</li>
                            <li>Blob URL格式: ${worldsWithBlobUrl} 个</li>
                        </ul>
                        
                        ${worldsWithThumbnail === 0 ? 
                            '<p style="color: #dc3545;"><strong>⚠️ 问题：所有世界都没有缩略图数据！</strong></p>' :
                            worldsWithValidUrl === 0 && worldsWithBase64 > 0 ?
                            '<p style="color: #856404;"><strong>⚠️ 注意：所有缩略图都是Base64格式，可能未上传到Storage</strong></p>' :
                            '<p style="color: #155724;"><strong>✅ 缩略图数据看起来正常</strong></p>'
                        }
                    </div>
                `;

                resultsEl.innerHTML = resultsHtml;
                console.log('=== 数据库缩略图检查完成 ===');

            } catch (error) {
                console.error('检查数据库失败:', error);
                resultsEl.innerHTML = `<div class="status error">❌ 检查失败: ${error.message}</div>`;
            }
        };

        // 测试图片加载
        window.testImageLoading = async function() {
            const resultsEl = document.getElementById('results');
            resultsEl.innerHTML = '<div class="loading">🖼️ 正在测试图片加载...</div>';

            try {
                const worlds = await RealWorldDataUtils.getAllWorlds();
                
                if (worlds.length === 0) {
                    resultsEl.innerHTML = '<div class="status warning">⚠️ 没有找到世界数据进行测试</div>';
                    return;
                }

                let resultsHtml = '<div class="status info">🖼️ 图片加载测试结果</div>';
                
                for (const world of worlds) {
                    if (!world.thumbnail) continue;

                    resultsHtml += `
                        <div class="world-card">
                            <div class="world-header">
                                <div class="world-name">${world.name}</div>
                                <div class="world-id">测试图片加载</div>
                            </div>
                            
                            <div class="thumbnail-test">
                                <div class="thumbnail-info">
                                    <h4>🔗 URL分析</h4>
                                    <div class="url-display">${world.thumbnail}</div>
                                    <p><strong>URL类型:</strong> ${
                                        world.thumbnail.startsWith('https://') ? '🔒 HTTPS' :
                                        world.thumbnail.startsWith('http://') ? '🌐 HTTP' :
                                        world.thumbnail.startsWith('data:') ? '📄 Base64' :
                                        world.thumbnail.startsWith('blob:') ? '🔗 Blob' : '❓ 未知'
                                    }</p>
                                </div>
                                
                                <div class="thumbnail-info">
                                    <h4>🖼️ 加载测试</h4>
                                    <img src="${world.thumbnail}" 
                                         class="thumbnail-preview" 
                                         alt="${world.name}"
                                         onload="this.nextElementSibling.innerHTML = '✅ 加载成功 (' + this.naturalWidth + 'x' + this.naturalHeight + ')'"
                                         onerror="this.style.display='none'; this.nextElementSibling.innerHTML = '❌ 加载失败 - 检查URL或网络连接'">
                                    <div class="status info">⏳ 加载中...</div>
                                </div>
                            </div>
                        </div>
                    `;
                }

                resultsEl.innerHTML = resultsHtml;

            } catch (error) {
                console.error('图片加载测试失败:', error);
                resultsEl.innerHTML = `<div class="status error">❌ 测试失败: ${error.message}</div>`;
            }
        };

        // 检查Storage文件
        window.checkStorageFiles = async function() {
            const resultsEl = document.getElementById('results');
            resultsEl.innerHTML = '<div class="loading">📁 正在检查Supabase Storage文件...</div>';

            try {
                console.log('=== 开始检查Storage文件 ===');
                
                // 模拟检查Storage中的文件
                const bucketName = 'world-thumbnails';
                const storageResult = await mockSupabaseClient.storage.from(bucketName).list();
                
                let resultsHtml = `
                    <div class="status warning">
                        <h3>📁 Storage文件检查</h3>
                        <p><strong>注意：</strong> 这是模拟环境，无法连接到真实的Supabase Storage。</p>
                        <p>在实际环境中，此功能将检查：</p>
                        <ul>
                            <li>world-thumbnails bucket中的文件列表</li>
                            <li>每个世界ID对应的缩略图文件是否存在</li>
                            <li>文件的访问权限和URL有效性</li>
                        </ul>
                    </div>
                `;

                // 获取世界数据并模拟检查
                const worlds = await RealWorldDataUtils.getAllWorlds();
                
                if (worlds.length > 0) {
                    resultsHtml += '<div class="status info"><h4>🔍 模拟Storage文件检查结果</h4></div>';
                    
                    for (const world of worlds) {
                        const expectedFileName = `${world.id}_thumbnail.png`;
                        const expectedUrl = `https://your-project.supabase.co/storage/v1/object/public/world-thumbnails/${expectedFileName}`;
                        
                        resultsHtml += `
                            <div class="world-card">
                                <div class="world-header">
                                    <div class="world-name">${world.name}</div>
                                    <div class="world-id">Storage检查</div>
                                </div>
                                
                                <div class="thumbnail-info">
                                    <p><strong>预期文件名:</strong> ${expectedFileName}</p>
                                    <p><strong>预期URL:</strong></p>
                                    <div class="url-display">${expectedUrl}</div>
                                    <p><strong>当前缩略图URL:</strong></p>
                                    <div class="url-display">${world.thumbnail || '无'}</div>
                                    <p><strong>URL匹配:</strong> ${world.thumbnail && world.thumbnail.includes(expectedFileName) ? '✅ 匹配' : '❌ 不匹配'}</p>
                                </div>
                            </div>
                        `;
                    }
                }

                resultsEl.innerHTML = resultsHtml;

            } catch (error) {
                console.error('Storage检查失败:', error);
                resultsEl.innerHTML = `<div class="status error">❌ Storage检查失败: ${error.message}</div>`;
            }
        };

        // 测试单个世界的缩略图
        window.testSingleWorldThumbnail = async function(worldId) {
            try {
                const worlds = await RealWorldDataUtils.getAllWorlds();
                const world = worlds.find(w => w.id === worldId);
                
                if (!world) {
                    alert('未找到指定的世界');
                    return;
                }

                console.log('详细测试世界:', world.name);
                console.log('缩略图数据:', world.thumbnail);
                
                // 创建详细测试窗口
                const testWindow = window.open('', '_blank', 'width=800,height=600');
                testWindow.document.write(`
                    <html>
                    <head>
                        <title>世界 ${world.name} 缩略图详细测试</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; }
                            .test-item { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 4px; }
                            .url-display { font-family: monospace; background: #f0f0f0; padding: 10px; word-break: break-all; }
                            img { max-width: 300px; border: 1px solid #ddd; }
                        </style>
                    </head>
                    <body>
                        <h1>世界 "${world.name}" 缩略图详细测试</h1>
                        
                        <div class="test-item">
                            <h3>📋 基本信息</h3>
                            <p><strong>世界ID:</strong> ${world.id}</p>
                            <p><strong>世界名称:</strong> ${world.name}</p>
                            <p><strong>创建时间:</strong> ${world.createdAt || '未知'}</p>
                        </div>
                        
                        <div class="test-item">
                            <h3>🔗 缩略图URL</h3>
                            <div class="url-display">${world.thumbnail || '无缩略图数据'}</div>
                        </div>
                        
                        ${world.thumbnail ? `
                            <div class="test-item">
                                <h3>🖼️ 图片预览</h3>
                                <img src="${world.thumbnail}" 
                                     alt="${world.name}"
                                     onload="document.getElementById('loadResult').innerHTML = '✅ 加载成功 - 尺寸: ' + this.naturalWidth + 'x' + this.naturalHeight"
                                     onerror="document.getElementById('loadResult').innerHTML = '❌ 加载失败 - 请检查URL或网络连接'">
                                <div id="loadResult">⏳ 正在加载...</div>
                            </div>
                        ` : ''}
                        
                        <div class="test-item">
                            <h3>🔍 完整世界数据</h3>
                            <pre style="background: #f8f9fa; padding: 15px; overflow: auto;">${JSON.stringify(world, null, 2)}</pre>
                        </div>
                    </body>
                    </html>
                `);
                testWindow.document.close();

            } catch (error) {
                console.error('单个世界测试失败:', error);
                alert('测试失败: ' + error.message);
            }
        };

        // 清除结果
        window.clearResults = function() {
            document.getElementById('results').innerHTML = '';
        };

        // 页面加载时的提示
        window.addEventListener('load', () => {
            console.log('缩略图数据库检查工具已加载');
            console.log('点击按钮开始检查缩略图数据');
        });
    </script>
</body>
</html>